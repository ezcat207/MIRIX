# é›†æˆæµ‹è¯•è¯´æ˜æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

`test_integration_full_pipeline.py` æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•ï¼ŒéªŒè¯ä»æˆªå›¾åˆ°å‰ç«¯å±•ç¤ºçš„æ•´ä¸ª raw_memory reference pipelineã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½

1. **OCR æå–**ï¼šä»çœŸå®æˆªå›¾ä¸­æå– URL å’Œæ–‡æœ¬
2. **Raw Memory åˆ›å»º**ï¼šåˆ›å»º raw_memory è®°å½•å¹¶å­˜å…¥æ•°æ®åº“
3. **Semantic Memory åˆ›å»º**ï¼šåˆ›å»º semantic_memory å¹¶å¼•ç”¨ raw_memory
4. **æ•°æ®åº“éªŒè¯**ï¼šéªŒè¯å¼•ç”¨å…³ç³»æ­£ç¡®å»ºç«‹
5. **API ç«¯ç‚¹æ¨¡æ‹Ÿ**ï¼šæ¨¡æ‹Ÿå‰ç«¯ API è°ƒç”¨ï¼ŒéªŒè¯è¿”å›æ­£ç¡®çš„å¼•ç”¨è¯¦æƒ…
6. **å‰ç«¯åŠŸèƒ½éªŒè¯**ï¼šé€»è¾‘éªŒè¯è¿‡æ»¤ã€æœç´¢ã€è·³è½¬å’Œé«˜äº®åŠŸèƒ½

## âš™ï¸ å‰ç½®è¦æ±‚

### æ–¹æ¡ˆ 1: ä½¿ç”¨ PostgreSQLï¼ˆæ¨èï¼‰

PostgreSQL æ”¯æŒæ•°æ®åº“è¿ç§»ï¼Œé¿å… schema ä¸åŒ¹é…é—®é¢˜ã€‚

```bash
# 1. å¯åŠ¨ PostgreSQLï¼ˆå¦‚æœè¿˜æ²¡å¯åŠ¨ï¼‰
brew services start postgresql@14

# 2. åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœè¿˜æ²¡åˆ›å»ºï¼‰
createdb mirix

# 3. è®¾ç½®ç¯å¢ƒå˜é‡
export MIRIX_PG_URI="postgresql://power@localhost:5432/mirix"

# 4. è¿è¡Œè¿ç§»è„šæœ¬
psql -U power -d mirix -f database/migrate_add_raw_memory.sql
```

### æ–¹æ¡ˆ 2: é‡ç½® SQLite æ•°æ®åº“

å¦‚æœåšæŒä½¿ç”¨ SQLiteï¼Œéœ€è¦å…ˆé‡ç½®æ•°æ®åº“ï¼š

```bash
# åˆ é™¤æ—§æ•°æ®åº“
rm ~/.mirix/sqlite.db

# é‡æ–°è¿è¡Œè¿ç§»
python database/run_sqlite_migration.py
```

**æ³¨æ„**ï¼šSQLite ä¸æ”¯æŒæ‰€æœ‰ PostgreSQL ç‰¹æ€§ï¼ˆå¦‚ pgvectorï¼‰ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™ã€‚

## ğŸš€ è¿è¡Œé›†æˆæµ‹è¯•

### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨é»˜è®¤æˆªå›¾ï¼ˆ~/.mirix/tmp/images/ ä¸­çš„ç¬¬ä¸€å¼ ï¼‰
python tests/test_integration_full_pipeline.py

# ä½¿ç”¨æŒ‡å®šæˆªå›¾
python tests/test_integration_full_pipeline.py --image /path/to/screenshot.png

# ä½¿ç”¨ä½ æä¾›çš„ imagilabs æˆªå›¾ï¼ˆéœ€è¦å…ˆä¿å­˜ï¼‰
# å°†æˆªå›¾ä¿å­˜åˆ° tests/test_data/imagilabs.pngï¼Œç„¶åè¿è¡Œï¼š
python tests/test_integration_full_pipeline.py --image tests/test_data/imagilabs.png
```

### ä½¿ç”¨çœŸå®æˆªå›¾

```bash
# ä½¿ç”¨ .mirix ç›®å½•ä¸­çš„çœŸå®æˆªå›¾
python tests/test_integration_full_pipeline.py --image ~/.mirix/tmp/images/screenshot-2025-09-05T06-30-37-992Z.png
```

## ğŸ“Š æµ‹è¯•è¾“å‡º

æµ‹è¯•ä¼šè¾“å‡ºå½©è‰²çš„æ­¥éª¤è¿›åº¦ï¼š

```
================================================================================
æ­¥éª¤ 0: éªŒè¯æµ‹è¯•å›¾ç‰‡
================================================================================

âœ… æ‰¾åˆ°æµ‹è¯•å›¾ç‰‡: /path/to/screenshot.png
â„¹ï¸  æ–‡ä»¶å¤§å°: 1724554 bytes

================================================================================
æ­¥éª¤ 1: OCR æå– URL å’Œæ–‡æœ¬
================================================================================

æå–çš„æ–‡æœ¬é•¿åº¦: 720 å­—ç¬¦
æå–çš„ URL æ•°é‡: 2
æå–çš„ URLs:
  1. https://youtube.com/watch?v=VDREHIOd80k
  2. https://usemotion.com
âœ… OCR æå–æˆåŠŸ

================================================================================
æ­¥éª¤ 2: åˆ›å»º Raw Memory è®°å½•
================================================================================

Raw Memory ID: rawmem-xxx-xxx-xxx
Source App: Chrome
Source URL: https://youtube.com/watch?v=VDREHIOd80k
Captured At: 2025-11-19 10:18:50
âœ… Raw Memory åˆ›å»ºæˆåŠŸ

...
```

## ğŸ” æ‰‹åŠ¨å‰ç«¯éªŒè¯

æµ‹è¯•å®Œæˆåï¼Œä¼šåˆ›å»ºæµ‹è¯•æ•°æ®ã€‚ä½ å¯ä»¥æ‰‹åŠ¨éªŒè¯å‰ç«¯åŠŸèƒ½ï¼š

```bash
# 1. å¯åŠ¨å‰ç«¯
cd frontend
npm start

# 2. æ‰“å¼€æµè§ˆå™¨å¹¶å¯¼èˆªåˆ° Memory Library

# 3. æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š
```

### âœ… æµ‹è¯•æ¸…å•

- [ ] **Semantic Memory**
  - [ ] æ‰¾åˆ°æµ‹è¯•åˆ›å»ºçš„ "Integration Test - Website Screenshot"
  - [ ] ç‚¹å‡» "æ˜¾ç¤ºè¯¦æƒ…" æŒ‰é’®
  - [ ] æŸ¥çœ‹ Memory References ç´«è‰²å¾½ç« 
  - [ ] å¾½ç« æ˜¾ç¤ºï¼šApp å›¾æ ‡ï¼ˆğŸŒï¼‰ã€URLã€æ—¥æœŸã€OCR é¢„è§ˆ

- [ ] **ç‚¹å‡»è·³è½¬åŠŸèƒ½**
  - [ ] ç‚¹å‡»ä¸€ä¸ª reference å¾½ç« 
  - [ ] ç¡®è®¤è‡ªåŠ¨åˆ‡æ¢åˆ° Raw Memory æ ‡ç­¾é¡µ
  - [ ] ç¡®è®¤æœç´¢æ¡†å¡«å……äº†å¯¹åº”çš„ raw_memory ID
  - [ ] ç¡®è®¤ç›®æ ‡é¡¹è¢«æ»šåŠ¨åˆ°è§†å›¾ä¸­å¿ƒ
  - [ ] ç¡®è®¤ç›®æ ‡é¡¹æœ‰ç´«è‰²è¾¹æ¡†å’Œè„‰å†²åŠ¨ç”»

- [ ] **Raw Memory è¿‡æ»¤å™¨**
  - [ ] ç‚¹å‡» ğŸ”— "åªæ˜¾ç¤ºè¢«å¼•ç”¨" æŒ‰é’®
  - [ ] ç¡®è®¤åªæ˜¾ç¤ºè¢« semantic/episodic memory å¼•ç”¨çš„ raw_memory
  - [ ] æµ‹è¯•åˆ›å»ºçš„ raw_memory åº”è¯¥å‡ºç°åœ¨è¿‡æ»¤ç»“æœä¸­

- [ ] **Raw Memory æœç´¢**
  - [ ] åœ¨æœç´¢æ¡†è¾“å…¥ raw_memory ID
  - [ ] ç¡®è®¤èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•

## ğŸ› å¸¸è§é—®é¢˜

### 1. `FOREIGN KEY constraint failed`

**åŸå› **ï¼šæµ‹è¯•ç”¨æˆ·åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨

**è§£å†³**ï¼šæµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºæµ‹è¯•ç”¨æˆ·å’Œç»„ç»‡ã€‚å¦‚æœä»ç„¶å¤±è´¥ï¼Œæ£€æŸ¥æ•°æ®åº“è¿æ¥ã€‚

### 2. `no such column: users.status`

**åŸå› **ï¼šSQLite schema è¿‡æ—¶

**è§£å†³**ï¼šé‡ç½®æ•°æ®åº“æˆ–ä½¿ç”¨ PostgreSQLï¼ˆè§"å‰ç½®è¦æ±‚"ï¼‰

### 3. `ModuleNotFoundError`

**åŸå› **ï¼šç¼ºå°‘ä¾èµ–æˆ– Python è·¯å¾„é—®é¢˜

**è§£å†³**ï¼š
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
cd /Volumes/Lexar/AISync90/MIRIX

# æ£€æŸ¥ Python ç¯å¢ƒ
which python
pip list | grep mirix
```

### 4. OCR æå–å¤±è´¥

**åŸå› **ï¼šç¼ºå°‘ tesseract

**è§£å†³**ï¼š
```bash
brew install tesseract
```

## ğŸ“ æµ‹è¯•æ•°æ®æ¸…ç†

æµ‹è¯•ä¼šåˆ›å»ºä»¥ä¸‹æ•°æ®ï¼š

- Raw Memory: `rawmem-test-xxx`
- Semantic Memory: `sem-test-xxx`
- Test User: `user-00000000-0000-4000-8000-000000000001`
- Test Organization: `org-00000000-0000-4000-8000-000000000000`

å¦‚éœ€æ¸…ç†æµ‹è¯•æ•°æ®ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ é™¤æˆ–è¿è¡Œï¼ˆTODO: æ·»åŠ æ¸…ç†è„šæœ¬ï¼‰ï¼š

```sql
-- PostgreSQL
DELETE FROM raw_memory WHERE id LIKE 'rawmem-test-%';
DELETE FROM semantic_memory WHERE id LIKE 'sem-test-%';
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œé›†æˆæµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰æ­¥éª¤é€šè¿‡
2. âœ… åœ¨å‰ç«¯æ‰‹åŠ¨éªŒè¯æ‰€æœ‰åŠŸèƒ½ï¼ˆå‚è€ƒæµ‹è¯•æ¸…å•ï¼‰
3. âœ… å¦‚æœå‘ç°é—®é¢˜ï¼Œæ£€æŸ¥ï¼š
   - æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æ˜¯å¦æœ‰ JavaScript é”™è¯¯
   - ç½‘ç»œè¯·æ±‚ï¼ˆF12 â†’ Networkï¼‰æ˜¯å¦æ­£å¸¸
   - åç«¯æ—¥å¿— `/tmp/mirix_server.log` æ˜¯å¦æœ‰é”™è¯¯
4. âœ… å®Œæˆ `phase1_task_list.md` ä¸­çš„ä»»åŠ¡ 11-14
5. âœ… å‡†å¤‡è¿›å…¥ Phase 2ï¼

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Phase 1 ä»»åŠ¡åˆ—è¡¨](../phase1_task_list.md)
- [Phase 1 è®¾è®¡æ–‡æ¡£](../phase1_raw_memory.md)
- [Claude å·¥ä½œæŒ‡å—](../Claude.md)

---

**åˆ›å»ºæ—¶é—´**: 2025-11-19
**æµ‹è¯•è„šæœ¬**: `tests/test_integration_full_pipeline.py`
**ä½œè€…**: MIRIX Team
