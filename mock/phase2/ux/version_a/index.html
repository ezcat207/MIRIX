<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>MIRIX RPG // STRATEGY HQ</title>
    <link rel="stylesheet" href="style.css">
    <script src="../shared_data.js"></script>
    <style>
        /* Extra styles for OKR Tree */
        .okr-tree {
            margin-bottom: 20px;
            border: 1px solid #555;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.3);
        }

        .objective-node {
            color: var(--text-gold);
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px dashed #555;
            padding-bottom: 5px;
        }

        .kr-node {
            margin-left: 20px;
            font-size: 12px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .kr-status.risk {
            color: var(--accent-red);
        }

        .kr-status.track {
            color: var(--accent-green);
        }

        .project-tag {
            font-size: 10px;
            background-color: #333;
            padding: 2px 4px;
            border-radius: 2px;
            margin-left: 5px;
            color: #aaa;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <!-- Header -->
        <div class="header">
            <div class="player-info">
                <div class="avatar">üßô‚Äç‚ôÇÔ∏è</div>
                <div>
                    <div style="font-weight: bold; color: var(--text-gold);" id="player-name">--</div>
                    <div style="font-size: 12px; color: #aaa;" id="player-class">--</div>
                </div>
                <div class="level-badge" id="player-level">LVL --</div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 12px; color: #aaa;">CURRENT SEASON</div>
                <div style="color: var(--accent-green);">Q4: THE AWAKENING</div>
            </div>
        </div>

        <!-- Character Sheet (Left) -->
        <div class="char-sheet">
            <div class="section-title">Attributes (O2 Metrics)</div>

            <div class="stat-row">
                <span class="stat-label">Growth Rate <span style="float:right" id="stat-growth">--</span></span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 85%; background-color: #4444ff;"></div>
                </div>
            </div>
            <div class="stat-row">
                <span class="stat-label">Wealth Flow <span style="float:right" id="stat-wealth">--</span></span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 42%; background-color: #ff44ff;"></div>
                </div>
            </div>
            <div class="stat-row">
                <span class="stat-label">Influence <span style="float:right" id="stat-inf">--</span></span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 60%; background-color: #ff4444;"></div>
                </div>
            </div>
            <div class="stat-row">
                <span class="stat-label">Review Clarity <span style="float:right" id="stat-clarity">--</span></span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%; background-color: #44ff44;"></div>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <div class="section-title">XP Progress</div>
                <div style="font-size: 12px; text-align: right; margin-bottom: 5px;" id="xp-text">-- / --</div>
                <div class="progress-bar" style="height: 15px; border-color: var(--text-gold);">
                    <div class="progress-fill" style="width: 0%; background-color: var(--text-gold);" id="xp-bar"></div>
                </div>
            </div>
        </div>

        <!-- Quest Board (Right) -->
        <div class="quest-board">
            <div class="section-title">Tree of Life (OKRs)</div>
            <div id="okr-list">
                <!-- Populated by JS -->
            </div>

            <div class="section-title" style="margin-top: 30px;">Daily Quests</div>
            <div id="daily-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Adventure Log -->
        <div class="log-panel" id="adventure-log">
            <div class="log-entry">> Oracle System initialized...</div>
            <div class="log-entry">> Analyzing Q4 Objectives...</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const data = SHARED_DATA;

            // Player Info
            document.getElementById('player-name').textContent = data.user.name;
            document.getElementById('player-class').textContent = data.user.class;
            document.getElementById('player-level').textContent = "LVL " + data.user.level;

            // Stats
            document.getElementById('stat-growth').textContent = data.user.attributes.growth_rate;
            document.getElementById('stat-wealth').textContent = data.user.attributes.wealth_flow;
            document.getElementById('stat-inf').textContent = data.user.attributes.influence;
            document.getElementById('stat-clarity').textContent = data.user.attributes.clarity;

            // XP
            document.getElementById('xp-text').textContent = `${data.user.xp.current} / ${data.user.xp.max}`;
            document.getElementById('xp-bar').style.width = (data.user.xp.current / data.user.xp.max * 100) + '%';

            // OKR Tree
            const okrList = document.getElementById('okr-list');
            data.okrs.forEach(o => {
                const div = document.createElement('div');
                div.className = 'okr-tree';

                let krsHtml = '';
                o.krs.forEach(kr => {
                    const statusClass = kr.status === 'At Risk' ? 'risk' : 'track';
                    const projects = kr.projects.map(pid => {
                        const p = data.projects.find(proj => proj.id === pid);
                        return p ? `<span class="project-tag">${p.name}</span>` : '';
                    }).join('');

                    krsHtml += `
                        <div class="kr-node">
                            <span>[${kr.code}] ${kr.title} ${projects}</span>
                            <span class="kr-status ${statusClass}">${kr.progress}% (${kr.status})</span>
                        </div>
                    `;
                });

                div.innerHTML = `
                    <div class="objective-node">[${o.code}] ${o.title}</div>
                    ${krsHtml}
                `;
                okrList.appendChild(div);
            });

            // Daily Tasks (Quests)
            const dailyList = document.getElementById('daily-list');
            data.daily_tasks.forEach(t => {
                const project = data.projects.find(p => p.id === t.project_id);
                const card = document.createElement('div');
                card.className = 'quest-card';
                if (t.completed) card.style.opacity = '0.5';

                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between;">
                        <div class="quest-title" style="font-size:14px;">
                            <span style="color:var(--accent-blue); font-size:10px;">[${project ? project.name : 'MISC'}]</span>
                            ${t.title}
                        </div>
                        <div style="color:var(--text-gold); font-size:10px;">${t.rpg_val}</div>
                    </div>
                    ${!t.completed ? '<button class="btn">COMPLETE</button>' : '<span style="color:#aaa;">[COMPLETED]</span>'}
                `;
                dailyList.appendChild(card);
            });

            // Log
            const log = document.getElementById('adventure-log');
            data.insights.forEach(ins => {
                const entry = document.createElement('div');
                entry.className = `log-entry ${ins.type === 'success' ? 'buff' : 'debuff'}`;
                entry.textContent = `> ${ins.rpg_msg}`;
                log.appendChild(entry);
            });
        });
    </script>
</body>

</html>